/**
 * Utilities.
 */

/**
 * A for-loop implementation - seems to work for number ranges but not lists.
 * WIP.
 *
 * @see https://github.com/seven-phases-max/less.curious/blob/master/src/for.less
 */

.yr-for-(@i, @n) {
    .-each(@i);
}

.yr-for-(@n) when (isnumber(@n)) {
    .yr-for-(1, @n);
}

.yr-for-(@i, @n) when not (@i = @n)  {
    .yr-for-((@i + (@n - @i) / abs(@n - @i)), @n);
}

/**
 * Simple pseudo-random.
 */

.yr-rand(@seed: 123456) {
    @r: sin(@seed) * 123456;
    @rand: @r - floor(@r);
}


/**
 * A way to use the media query selectors.
 *
 * @example `.yr-m-(~'only screen and @{yr-mq-s-m}'); .-q() {...}`
 */

.yr-m-(@query) {
    @media @query {
        .-q();
    }
}


/**
 * Convenience for toggling a global or local flag.
 *
 * This will enable the contents when `.flag` is present at or above the element scope:
 * `.yr-on-(~'.flag'); .-do() {...}`
 * Becomes:
 * `&.flag, .flag & {...}`
 * 
 * @note The scoping's a little funny here, to closure the mixin callback scope:
 *       `& { .yr-on-(...); .-do() {...}}` keeps `.-do` in a closure.
 *       `.yr-on-(...); .-do() {...}` leaves `.-do` out in local scope.
 */

.yr-on-(@flag) {
    &@{flag},
    @{flag} & {
        .-do();
    }
}


/**
 * Link styling.
 */

.yr-a() {
    .yr-on-(~'.tweak-yr-fancy-links'); .-do() {
        position: relative;
        display: inline-block;
        border: 0 solid currentColor;
        text-decoration: none;
        z-index: 1;

        &[target="_blank"] {
            border-style: dashed;
        }

        &::before {
            content: '';
            position: absolute;
            display: block;
            border: inherit;
            z-index: -1;

            @x: -2px;
            left: @x;
            right: @x;
            bottom: 0;
            border-bottom-width: 1px;
            pointer-events: none;
            .transform-origin(bottom);
            will-change: transform, opacity, border-color;
            .transition(transform 500ms ease-out,
                opacity 500ms ease-out,
                border-color 500ms ease-out;);
        }

        &:visited::before {
            opacity: 0.33;
        }

        &:hover,
        &:focus,
        &:active {
            &::before {
                .transition(transform 200ms ease-out,
                    opacity 300ms ease-out,
                    border-color 300ms ease-out;);
            }
        }

        &:hover,
        &:focus {
            &::before {
                .transform(scaleY(4));
                opacity: 0.33;
            }
        }

        &:active::before {
            .transform(scaleY(0));
        }

        &:empty::before {
            left: 0;
            right: 0;
        }
    }
}


/**
 * Aliases.
 */

.display(@display) when (@display = flex) {
    .flex-block();
}
.display(@display) when (@display = inline-flex) {
    .flex-inline();
}
